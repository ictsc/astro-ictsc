---
import CollectionLayout from "../../layout/CollectionLayout.astro";
import ArticleCard from "../../components/ArticleCard.astro";

export async function getStaticPaths() {
    const allPosts = await Astro.glob("../../content/blog/**/*.md");

    const uniqueTags = [
        ...new Set(allPosts.map((post: any) => post.frontmatter.tags).flat()),
    ];

    return uniqueTags.map((tag: string) => ({
        params: { tag },
        props: { posts: allPosts },
    }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;

const filteredPosts = posts.filter((post: any) =>
    post.frontmatter.tags.includes(tag)
);
---

<CollectionLayout meta="カテゴリ" title={tag}>
    <div class="text-sm breadcrumbs" slot="breadCrumbs">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/category">Category</a></li>
            <li><a href={`/category/${tag}/`}>{tag}</a></li>
        </ul>
    </div>
    {
        filteredPosts.map((post: any) => (
            <ArticleCard
                href={`/${post.frontmatter.slug}/`}
                title={post.frontmatter.title}
                tags={post.frontmatter.tags}
            />
        ))
    }
</CollectionLayout>
